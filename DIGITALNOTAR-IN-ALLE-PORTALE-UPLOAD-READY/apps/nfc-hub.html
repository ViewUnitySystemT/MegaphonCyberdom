<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFC Hub</title>
    <link rel="stylesheet" href="../styles.css">
    <style>
        body { 
            font-family: var(--font-family); 
            background-color: var(--background); 
            color: var(--on-background); 
            padding: 20px; 
        }
        .nfc-container { 
            max-width: 900px; 
            margin: 0 auto; 
            background: var(--surface); 
            border-radius: var(--radius-lg); 
            box-shadow: var(--shadow-md); 
            padding: 30px; 
        }
        h1 { 
            color: var(--primary); 
            text-align: center; 
            margin-bottom: 30px; 
        }
        .nfc-section { 
            margin-bottom: 30px; 
            padding: 20px; 
            background: var(--surface-variant); 
            border-radius: var(--radius-md); 
        }
        .nfc-section h3 { 
            color: var(--on-surface); 
            margin-bottom: 15px; 
            display: flex; 
            align-items: center; 
            gap: 10px; 
        }
        .nfc-status { 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            padding: 15px; 
            background: var(--surface); 
            border-radius: var(--radius-sm); 
            margin-bottom: 20px; 
        }
        .status-indicator { 
            width: 12px; 
            height: 12px; 
            border-radius: 50%; 
            background: var(--success); 
        }
        .status-indicator.offline { 
            background: var(--error); 
        }
        .status-indicator.unknown { 
            background: var(--warning); 
        }
        .nfc-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 20px; 
        }
        .nfc-card { 
            background: var(--surface); 
            padding: 20px; 
            border-radius: var(--radius-md); 
            border: 2px solid var(--outline); 
            transition: all 0.3s ease; 
            cursor: pointer; 
        }
        .nfc-card:hover { 
            border-color: var(--primary); 
            transform: translateY(-2px); 
            box-shadow: var(--shadow-lg); 
        }
        .nfc-card.active { 
            border-color: var(--primary); 
            background: var(--primary-container); 
        }
        .nfc-icon { 
            font-size: 2rem; 
            margin-bottom: 10px; 
        }
        .nfc-title { 
            font-size: 1.1rem; 
            font-weight: bold; 
            margin-bottom: 5px; 
        }
        .nfc-description { 
            color: var(--on-surface-variant); 
            font-size: 0.9rem; 
            margin-bottom: 15px; 
        }
        .nfc-actions { 
            display: flex; 
            gap: 10px; 
            flex-wrap: wrap; 
        }
        .btn { 
            padding: 8px 16px; 
            border: none; 
            border-radius: var(--radius-sm); 
            cursor: pointer; 
            font-size: 0.9rem; 
            display: flex; 
            align-items: center; 
            gap: 5px; 
            transition: all 0.3s ease; 
            flex: 1; 
            justify-content: center; 
        }
        .btn-primary { 
            background-color: var(--primary); 
            color: var(--on-primary); 
        }
        .btn-secondary { 
            background-color: var(--secondary); 
            color: var(--on-secondary); 
        }
        .btn-success { 
            background-color: var(--success); 
            color: var(--on-success); 
        }
        .btn:hover { 
            opacity: 0.9; 
            transform: translateY(-1px); 
        }
        .btn:disabled { 
            opacity: 0.5; 
            cursor: not-allowed; 
            transform: none; 
        }
        .nfc-reader { 
            text-align: center; 
            padding: 30px; 
            background: var(--surface); 
            border-radius: var(--radius-md); 
            border: 2px dashed var(--outline); 
            margin-bottom: 20px; 
        }
        .nfc-reader.active { 
            border-color: var(--primary); 
            background: var(--primary-container); 
            animation: nfcPulse 2s infinite; 
        }
        @keyframes nfcPulse { 
            0%, 100% { 
                border-color: var(--primary); 
                box-shadow: 0 0 0 0 var(--primary-container); 
            } 
            50% { 
                border-color: var(--secondary); 
                box-shadow: 0 0 0 10px var(--primary-container); 
            } 
        }
        .nfc-data { 
            background: var(--surface); 
            border-radius: var(--radius-sm); 
            padding: 15px; 
            margin-top: 15px; 
            font-family: monospace; 
            font-size: 0.9rem; 
            word-break: break-all; 
        }
        .nfc-history { 
            max-height: 300px; 
            overflow-y: auto; 
        }
        .history-item { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 10px; 
            border-bottom: 1px solid var(--outline); 
        }
        .history-item:last-child { 
            border-bottom: none; 
        }
        .history-content { 
            flex: 1; 
            margin-right: 10px; 
        }
        .history-time { 
            font-size: 0.8rem; 
            color: var(--on-surface-variant); 
        }
        .nfc-tag { 
            display: inline-block; 
            background: var(--primary); 
            color: var(--on-primary); 
            padding: 2px 8px; 
            border-radius: 12px; 
            font-size: 0.8rem; 
            margin-right: 5px; 
        }
    </style>

        <style>
            .navigation-buttons {
                position: fixed;
                bottom: 20px;
                right: 20px;
                display: flex;
                gap: 10px;
                z-index: 1000;
            }
            
            .nav-btn {
                width: 50px;
                height: 50px;
                border-radius: 50%;
                border: none;
                background: var(--primary, #007bff);
                color: white;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: 0 2px 10px rgba(0,0,0,0.2);
                transition: all 0.3s ease;
            }
            
            .nav-btn:hover {
                transform: scale(1.1);
                box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            }
            
            .nav-btn:disabled {
                opacity: 0.5;
                cursor: not-allowed;
                transform: none;
            }
            
            .nav-btn svg {
                width: 20px;
                height: 20px;
            }
        </style>

    </head>
<body>
    
        <header class="top-app-bar">
            <div class="top-app-bar-content">
                <button class="icon-button" onclick="window.history.back()" title="Zur√ºck" title="Action Button">
                    <svg class="icon" viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
                </button>
                <h1 class="top-app-bar-title">Navigation</h1>
                <div class="top-app-bar-actions"><button class="icon-button" onclick="window.history.forward()" title="Vorw√§rts" title="Action Button">
                        <svg class="icon" viewBox="0 0 24 24"><path d="M4 11v2h12.17l-5.59 5.59L12 20l8-8-8-8-1.41 1.41L16.17 11H4z"/></svg>
                    </button>
                    
                    <button class="icon-button" onclick="window.history.forward()" title="Vorw√§rts" title="Action Button">
                        <svg class="icon" viewBox="0 0 24 24"><path d="M4 11v2h12.17l-5.59 5.59L12 20l8-8-8-8-1.41 1.41L16.17 11H4z"/></svg>
                    </button>
                </div>
            </div>
        </header>
        <main class="main-content">

    <div class="nfc-container">
        <h1>üì° NFC Hub - Near Field Communication</h1>
        
        <!-- NFC Status -->
        <div class="nfc-section">
            <h3>üì° NFC Status</h3>
            <div class="nfc-status">
                <div id="nfcStatusIndicator" class="status-indicator offline"></div>
                <span id="nfcStatusText">NFC wird √ºberpr√ºft...</span>
            </div>
        </div>

        <!-- NFC Reader -->
        <div class="nfc-section">
            <h3>üìñ NFC Reader</h3>
            <div class="nfc-reader" id="nfcReader">
                <div class="nfc-icon">üì°</div>
                <h4>NFC-Tag hier halten</h4>
                <p>Halte dein NFC-Ger√§t oder Tag in die N√§he des Displays</p>
                <button class="btn btn-primary" id="startReaderBtn" onclick="startNFCReader()" title="Action Button">
                    ‚ñ∂Ô∏è Reader starten
                </button>
                <button class="btn btn-secondary" id="stopReaderBtn" onclick="stopNFCReader()" disabled title="Action Button">
                    ‚èπÔ∏è Reader stoppen
                </button>
            </div>
            <div id="nfcData" class="nfc-data" style="display: block;">
                <strong>Gelesene NFC-Daten:</strong><br>
                <span id="nfcDataContent"></span>
            </div>
        </div>

        <!-- NFC Writer -->
        <div class="nfc-section">
            <h3>‚úçÔ∏è NFC Writer</h3>
            <div class="nfc-grid">
                <div class="nfc-card" onclick="writeNFCType('url')">
                    <div class="nfc-icon">üåê</div>
                    <div class="nfc-title">URL schreiben</div>
                    <div class="nfc-description">Eine Website-URL auf NFC-Tag schreiben</div>
                    <div class="nfc-actions">
                        <button class="btn btn-primary" onclick="writeURL()" title="Action Button">
                            ‚úçÔ∏è URL schreiben
                        </button>
                    </div>
                </div>
                
                <div class="nfc-card" onclick="writeNFCType('contact')">
                    <div class="nfc-icon">üë§</div>
                    <div class="nfc-title">Kontakt schreiben</div>
                    <div class="nfc-description">Kontaktinformationen auf NFC-Tag schreiben</div>
                    <div class="nfc-actions">
                        <button class="btn btn-primary" onclick="writeContact()" title="Action Button">
                            ‚úçÔ∏è Kontakt schreiben
                        </button>
                    </div>
                </div>
                
                <div class="nfc-card" onclick="writeNFCType('wifi')">
                    <div class="nfc-icon">üì∂</div>
                    <div class="nfc-title">WiFi schreiben</div>
                    <div class="nfc-description">WiFi-Zugangsdaten auf NFC-Tag schreiben</div>
                    <div class="nfc-actions">
                        <button class="btn btn-primary" onclick="writeWiFi()" title="Action Button">
                            ‚úçÔ∏è WiFi schreiben
                        </button>
                    </div>
                </div>
                
                <div class="nfc-card" onclick="writeNFCType('app')">
                    <div class="nfc-icon">üì±</div>
                    <div class="nfc-title">App-Link schreiben</div>
                    <div class="nfc-description">TELCO Hub App-Link auf NFC-Tag schreiben</div>
                    <div class="nfc-actions">
                        <button class="btn btn-primary" onclick="writeAppLink()" title="Action Button">
                            ‚úçÔ∏è App-Link schreiben
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- NFC History -->
        <div class="nfc-section">
            <h3>üìú NFC-Verlauf</h3>
            <div class="nfc-history" id="nfcHistory">
                <p style="text-align: center; color: var(--on-surface-variant);">
                    Noch keine NFC-Interaktionen
                </p>
            </div>
            <div style="text-align: center; margin-top: 15px;">
                <button class="btn btn-secondary" onclick="clearNFCHistory()" title="Action Button">
                    üóëÔ∏è Verlauf l√∂schen
                </button>
                <button class="btn btn-primary" onclick="exportNFCHistory()" title="Action Button">
                    üì§ Verlauf exportieren
                </button>
            </div>
        </div>

        <!-- NFC Capabilities -->
        <div class="nfc-section">
            <h3>üîß NFC-Funktionen</h3>
            <div class="nfc-grid">
                <div class="nfc-card">
                    <div class="nfc-icon">üîí</div>
                    <div class="nfc-title">Sicherheit</div>
                    <div class="nfc-description">Verschl√ºsselte NFC-√úbertragungen</div>
                    <div class="nfc-actions">
                        <button class="btn btn-success" onclick="enableNFCSecurity()" title="Action Button">
                            üîí Aktivieren
                        </button>
                    </div>
                </div>
                
                <div class="nfc-card">
                    <div class="nfc-icon">‚ö°</div>
                    <div class="nfc-title">Schnellverbindung</div>
                    <div class="nfc-description">Automatische Verbindung bei NFC-Kontakt</div>
                    <div class="nfc-actions">
                        <button class="btn btn-success" onclick="enableQuickConnect()" title="Action Button">
                            ‚ö° Aktivieren
                        </button>
                    </div>
                </div>
                
                <div class="nfc-card">
                    <div class="nfc-icon">üîÑ</div>
                    <div class="nfc-title">Auto-Sync</div>
                    <div class="nfc-description">Automatische Synchronisation bei Kontakt</div>
                    <div class="nfc-actions">
                        <button class="btn btn-success" onclick="enableAutoSync()" title="Action Button">
                            üîÑ Aktivieren
                        </button>
                    </div>
                </div>
                
                <div class="nfc-card">
                    <div class="nfc-icon">üìä</div>
                    <div class="nfc-title">Analytics</div>
                    <div class="nfc-description">NFC-Nutzungsstatistiken</div>
                    <div class="nfc-actions">
                        <button class="btn btn-primary" onclick="viewNFCAnalytics()" title="Action Button">
                            üìä Anzeigen
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class NFCHub {
            constructor() {
                this.nfcReader = null;
                this.isReading = false;
                this.nfcHistory = JSON.parse(localStorage.getItem('nfcHistory') || '[]');
                this.nfcCapabilities = {
                    reading: false,
                    writing: false,
                    security: false,
                    quickConnect: false,
                    autoSync: false
                };
                
                this.init();
            }

            init() {
                this.checkNFCCapabilities();
                this.renderNFCHistory();
                this.updateNFCStatus();
            }

            checkNFCCapabilities() {
                if ('NDEFReader' in window) {
                    this.nfcCapabilities.reading = true;
                    this.nfcCapabilities.writing = true;
                    this.updateNFCStatus('NFC wird unterst√ºtzt', 'online');
                } else {
                    this.updateNFCStatus('NFC wird nicht unterst√ºtzt', 'offline');
                }
            }

            updateNFCStatus(message, status) {
                const indicator = document.getElementById('nfcStatusIndicator');
                const text = document.getElementById('nfcStatusText');
                
                indicator.className = `status-indicator ${status}`;
                text.textContent = message;
            }

            async startNFCReader() {
                if (!this.nfcCapabilities.reading) {
                    alert('NFC-Reading wird nicht unterst√ºtzt');
                    return;
                }

                try {
                    this.nfcReader = new NDEFReader();
                    await this.nfcReader.scan();
                    
                    this.isReading = true;
                    this.updateReaderUI(true);
                    
                    this.nfcReader.addEventListener('reading', (event) => {
                        this.handleNFCReading(event);
                    });
                    
                    this.nfcReader.addEventListener('readingerror', (event) => {
                        console.error('NFC Reading Error:', event);
                        this.addToHistory('NFC-Reading-Fehler', 'error');
                    });
                    
                } catch (error) {
                    console.error('NFC Reader Error:', error);
                    alert('NFC-Reader konnte nicht gestartet werden: ' + error.message);
                }
            }

            stopNFCReader() {
                this.isReading = false;
                this.updateReaderUI(false);
                
                if (this.nfcReader) {
                    // NDEFReader doesn't have a stop method, just stop listening
                    this.nfcReader = null;
                }
            }

            updateReaderUI(active) {
                const reader = document.getElementById('nfcReader');
                const startBtn = document.getElementById('startReaderBtn');
                const stopBtn = document.getElementById('stopReaderBtn');
                
                if (active) {
                    reader.classList.add('active');
                    startBtn.disabled = true;
                    stopBtn.disabled = false;
                } else {
                    reader.classList.remove('active');
                    startBtn.disabled = false;
                    stopBtn.disabled = true;
                }
            }

            handleNFCReading(event) {
                console.log('NFC Tag gelesen:', event);
                
                const records = event.message.records;
                let content = '';
                
                records.forEach((record, index) => {
                    if (record.recordType === 'text') {
                        const textDecoder = new TextDecoder(record.encoding);
                        content += `Text: ${textDecoder.decode(record.data)}\n`;
                    } else if (record.recordType === 'url') {
                        content += `URL: ${record.data}\n`;
                    } else if (record.recordType === 'mime') {
                        const textDecoder = new TextDecoder();
                        content += `MIME: ${record.mediaType} - ${textDecoder.decode(record.data)}\n`;
                    } else {
                        content += `Unbekannt: ${record.recordType}\n`;
                    }
                });
                
                this.displayNFCData(content);
                this.addToHistory(`NFC-Tag gelesen: ${content.substring(0, 50)}...`, 'success');
            }

            displayNFCData(content) {
                const dataDiv = document.getElementById('nfcData');
                const contentSpan = document.getElementById('nfcDataContent');
                
                contentSpan.textContent = content;
                dataDiv.style.display = 'block';
            }

            async writeNFCData(records) {
                if (!this.nfcCapabilities.writing) {
                    alert('NFC-Writing wird nicht unterst√ºtzt');
                    return;
                }

                try {
                    const nfcWriter = new NDEFWriter();
                    await nfcWriter.write({
                        records: records
                    });
                    
                    alert('Daten erfolgreich auf NFC-Tag geschrieben!');
                    this.addToHistory('Daten auf NFC-Tag geschrieben', 'success');
                    
                } catch (error) {
                    console.error('NFC Writing Error:', error);
                    alert('Fehler beim Schreiben auf NFC-Tag: ' + error.message);
                    this.addToHistory('NFC-Schreibfehler', 'error');
                }
            }

            addToHistory(message, type) {
                const entry = {
                    message: message,
                    type: type,
                    timestamp: new Date().toISOString()
                };
                
                this.nfcHistory.unshift(entry);
                if (this.nfcHistory.length > 50) {
                    this.nfcHistory = this.nfcHistory.slice(0, 50);
                }
                
                localStorage.setItem('nfcHistory', JSON.stringify(this.nfcHistory));
                this.renderNFCHistory();
            }

            renderNFCHistory() {
                const container = document.getElementById('nfcHistory');
                
                if (this.nfcHistory.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: var(--on-surface-variant);">Noch keine NFC-Interaktionen</p>';
                    return;
                }
                
                container.innerHTML = this.nfcHistory.map(entry => {
                    const time = new Date(entry.timestamp).toLocaleString();
                    const typeClass = `log-${entry.type}`;
                    
                    return `
                        <div class="history-item">
                            <div class="history-content">
                                <div>${entry.message}</div>
                                <div class="history-time">${time}</div>
                            </div>
                            <span class="nfc-tag ${typeClass}">${entry.type.toUpperCase()}</span>
                        </div>
                    `;
                }).join('');
            }
        }

        // Global functions
        function startNFCReader() {
            window.nfcHub.startNFCReader();
        }

        function stopNFCReader() {
            window.nfcHub.stopNFCReader();
        }

        function writeNFCType(type) {
            // Remove active class from all cards
            document.querySelectorAll('.nfc-card').forEach(card => card.classList.remove('active'));
            
            // Add active class to clicked card
            event.currentTarget.classList.add('active');
        }

        function writeURL() {
            const url = prompt('URL eingeben:', 'https://example.com');
            if (url) {
                window.nfcHub.writeNFCData([
                    { recordType: 'url', data: url }
                ]);
            }
        }

        function writeContact() {
            const name = prompt('Name eingeben:', 'Max Mustermann');
            const phone = prompt('Telefon eingeben:', '+49 123 456789');
            const email = prompt('E-Mail eingeben:', 'max@example.com');
            
            if (name && phone && email) {
                const vcard = `BEGIN:VCARD
VERSION:3.0
FN:${name}
TEL:${phone}
EMAIL:${email}
END:VCARD`;
                
                window.nfcHub.writeNFCData([
                    { recordType: 'mime', mediaType: 'text/vcard', data: vcard }
                ]);
            }
        }

        function writeWiFi() {
            const ssid = prompt('WiFi-Name (SSID):', 'MyWiFi');
            const password = prompt('WiFi-Passwort:', '');
            const security = prompt('Sicherheit (WPA, WEP, nopass):', 'WPA');
            
            if (ssid && password && security) {
                const wifiData = `WIFI:T:${security};S:${ssid};P:${password};H:false;;`;
                window.nfcHub.writeNFCData([
                    { recordType: 'mime', mediaType: 'application/vnd.wfa.wsc', data: wifiData }
                ]);
            }
        }

        function writeAppLink() {
            const appUrl = window.location.origin + '/?source=nfc';
            window.nfcHub.writeNFCData([
                { recordType: 'url', data: appUrl }
            ]);
        }

        function enableNFCSecurity() {
            window.nfcHub.nfcCapabilities.security = true;
            alert('NFC-Sicherheit aktiviert!');
        }

        function enableQuickConnect() {
            window.nfcHub.nfcCapabilities.quickConnect = true;
            alert('Schnellverbindung aktiviert!');
        }

        function enableAutoSync() {
            window.nfcHub.nfcCapabilities.autoSync = true;
            alert('Auto-Sync aktiviert!');
        }

        function viewNFCAnalytics() {
            const total = window.nfcHub.nfcHistory.length;
            const reads = window.nfcHub.nfcHistory.filter(e => e.message.includes('gelesen')).length;
            const writes = window.nfcHub.nfcHistory.filter(e => e.message.includes('geschrieben')).length;
            
            alert(`NFC Analytics:
Gesamt: ${total} Interaktionen
Gelesen: ${reads}
Geschrieben: ${writes}
Sicherheit: ${window.nfcHub.nfcCapabilities.security ? 'Aktiv' : 'Inaktiv'}
Schnellverbindung: ${window.nfcHub.nfcCapabilities.quickConnect ? 'Aktiv' : 'Inaktiv'}`);
        }

        function clearNFCHistory() {
            if (confirm('NFC-Verlauf wirklich l√∂schen?')) {
                window.nfcHub.nfcHistory = [];
                localStorage.removeItem('nfcHistory');
                window.nfcHub.renderNFCHistory();
            }
        }

        function exportNFCHistory() {
            const dataStr = JSON.stringify(window.nfcHub.nfcHistory, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `nfc-history-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
        }

        // Initialize when page loads
        window.addEventListener('DOMContentLoaded', () => {
            window.nfcHub = new NFCHub();
        });
    </script>
        </main>
    
        <script>
            // Browser Navigation Enhancement
            document.addEventListener('DOMContentLoaded', function() {
                // Navigation-Status anzeigen
                updateNavigationStatus();
                
                // Popstate Event f√ºr Browser-Navigation
                window.addEventListener('popstate', function(event) {
                    console.log('Browser Navigation:', event.state);
                    updateNavigationStatus();
                });
                
                // Navigation-Status aktualisieren
                function updateNavigationStatus() {
                    const canGoBack = window.history.length > 1;
                    const canGoForward = window.history.length > 1; // Vereinfacht
                    
                    // Back-Button aktivieren/deaktivieren
                    const backButtons = document.querySelectorAll('button[onclick*="history.back"]');
                    backButtons.forEach(btn => {
                        btn.disabled = !canGoBack;
                        btn.style.opacity = canGoBack ? '1' : '0.5';
                    });
                    
                    // Forward-Button aktivieren/deaktivieren
                    const forwardButtons = document.querySelectorAll('button[onclick*="history.forward"]');
                    forwardButtons.forEach(btn => {
                        btn.disabled = !canGoForward;
                        btn.style.opacity = canGoForward ? '1' : '0.5';
                    });
                }
                
                // Globale Navigation-Funktionen
                window.goBack = function() {
                    if (window.history.length > 1) {
                        window.history.back();
                    }
                };
                
                window.goForward = function() {
                    window.history.forward();
                };
                
                window.goHome = function() {
                    window.location.href = '/';
                };
            });
        </script>

    </body>
</html>



